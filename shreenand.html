<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Trade Request Test</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { margin-top: 20px; }
    form label { display: block; margin: 10px 0 5px; }
    form input { padding: 8px; width: 300px; }
    form button { padding: 10px 15px; background: #007bff; color: #fff; border: none; cursor: pointer; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 8px; text-align: left; }
  </style>
  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyEiHHzllx1fUgY3y8AevxzqcQP1xL3RnmBKKYoBgmMZvNQ-ZRXBXG4m15Ko6n4YRjy_A/exec";  // Replace with your Apps Script Web App URL

    // Function to submit a trade request from the buyer's side.
    async function submitTradeRequest(event) {
      event.preventDefault();
      const tradeData = {
        action: "submitTradeRequest",
        buyerUID: "A1",         // Shreenand's UID (buyer)
        buyerName: "Shreenand",
        sellerUID: document.getElementById("sellerUID").value.trim(),
        stock: document.getElementById("stock").value.trim(),
        quantity: document.getElementById("quantity").value,
        price: document.getElementById("price").value
      };
      
      try {
        const response = await fetch(SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(tradeData)
        });
        const result = await response.json();
        alert(result.message);
        loadTradeRequests();  // Refresh pending trade requests after submission.
      } catch (error) {
        console.error("Error submitting trade request:", error);
      }
    }
    
    // Function to load pending trade requests for a specific seller.
    async function loadTradeRequests() {
      // For this demo, we load trade requests where the seller is A2 (Kamya).
      const sellerUID = "A2";
      try {
        const response = await fetch(SCRIPT_URL + '?action=getTradeRequests&sellerUID=' + encodeURIComponent(sellerUID));
        const result = await response.json();
        const tbody = document.getElementById("requestsTbody");
        tbody.innerHTML = "";
        if (result.success && result.tradeRequests.length > 0) {
          result.tradeRequests.forEach(req => {
            tbody.innerHTML += `<tr>
              <td>${req.buyerUID}</td>
              <td>${req.buyerName}</td>
              <td>${req.stock}</td>
              <td>${req.quantity}</td>
              <td>$${req.price}</td>
              <td>${new Date(req.timestamp).toLocaleString()}</td>
            </tr>`;
          });
        } else {
          tbody.innerHTML = `<tr><td colspan="6">No trade requests found.</td></tr>`;
        }
      } catch (error) {
        console.error("Error loading trade requests:", error);
      }
    }
  </script>
</head>
<body>
  <h2>Submit Trade Request (Buyer: Shreenand, UID: A1)</h2>
  <form onsubmit="submitTradeRequest(event)">
    <label for="sellerUID">Seller UID:</label>
    <input type="text" id="sellerUID" placeholder="Enter Seller UID (e.g., A2)" required>
    <label for="stock">Stock Symbol:</label>
    <input type="text" id="stock" placeholder="e.g., AAPL" required>
    <label for="quantity">Quantity:</label>
    <input type="number" id="quantity" placeholder="Number of Shares" required>
    <label for="price">Price per Share:</label>
    <input type="number" id="price" placeholder="Agreed Price" required>
    <button type="submit">Send Trade Request</button>
  </form>
  
  <h2>Trade Requests for Seller A2 (Kamya)</h2>
  <button onclick="loadTradeRequests()">Load Trade Requests</button>
  <table>
    <thead>
      <tr>
        <th>Buyer UID</th>
        <th>Buyer Name</th>
        <th>Stock</th>
        <th>Quantity</th>
        <th>Price</th>
        <th>Time</th>
      </tr>
    </thead>
    <tbody id="requestsTbody">
      <tr><td colspan="6">No trade requests loaded.</td></tr>
    </tbody>
  </table>
</body>
</html>
