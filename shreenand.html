<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AWIFS - Shreenand's Portal</title>
  <style>
    /* RESET */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body, html { font-family: 'Arial', sans-serif; background: #f4f7f9; color: #333; }
    
    /* SIDEBAR */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 220px;
      height: 100vh;
      background-color: #2c3e50;
      color: #ecf0f1;
      padding: 20px;
      overflow-y: auto;
    }
    .sidebar h2 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 24px;
      letter-spacing: 2px;
    }
    .sidebar p {
      text-align: center;
      margin-bottom: 30px;
      font-size: 16px;
    }
    .sidebar ul {
      list-style: none;
    }
    .sidebar ul li {
      padding: 15px 20px;
      margin-bottom: 10px;
      cursor: pointer;
      border-radius: 3px;
    }
    .sidebar ul li:hover, .sidebar ul li.active {
      background-color: #34495e;
    }
    
    /* MAIN CONTENT */
    .main-content {
      margin-left: 240px;
      padding: 20px;
    }
    .card {
      background: #fff;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h2.section-title {
      margin-bottom: 15px;
    }
    
    /* FORM STYLES */
    form label { display: block; margin: 10px 0 5px; }
    form input, form select {
      padding: 8px;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 3px;
    }
    form button {
      margin-top: 15px;
      padding: 10px 15px;
      border: none;
      background-color: #27ae60;
      color: #fff;
      border-radius: 3px;
      cursor: pointer;
    }
    .loading {
      display: none;
      color: #007bff;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <h2>AWIFS Mock Stock</h2>
    <p>UID: A1</p>
    <p>Name: Shreenand</p>
    <ul>
      <li class="active" onclick="showSection('dashboard')">Dashboard</li>
      <li onclick="showSection('trade')">Trade</li>
      <!-- Other menu items (Portfolio, News, Leaderboard) can be added here -->
    </ul>
  </div>
  
  <!-- Main Content -->
  <div class="main-content">
    <!-- Dashboard Section (dummy content for now) -->
    <div id="dashboard" class="section" style="display: block;">
      <div class="card">
        <h2 class="section-title">Dashboard</h2>
        <p>This is the dashboard. (Dummy stock data and transactions can be shown here.)</p>
      </div>
    </div>
    
    <!-- Trade Section: Shreenand (A1) can send a trade request -->
    <div id="trade" class="section" style="display: none;">
      <div class="card">
        <h2 class="section-title">Send Trade Request</h2>
        <form id="tradeForm" onsubmit="submitTradeRequest(event)">
          <label for="sellerUID">Seller UID:</label>
          <input type="text" id="sellerUID" placeholder="Enter Seller UID (e.g., A2)" required>
          <label for="stock">Stock Symbol:</label>
          <input type="text" id="stock" placeholder="e.g., AAPL" required>
          <label for="quantity">Quantity:</label>
          <input type="number" id="quantity" placeholder="Number of Shares" required>
          <label for="price">Agreed Price:</label>
          <input type="number" id="price" placeholder="Price per Share" required>
          <button type="submit" id="submitBtn">Send Trade Request</button>
          <div class="loading" id="loadingIndicator">Loading...</div>
        </form>
      </div>
      <!-- For now we focus only on registering the request in the sheet -->
      <div class="card">
        <h2 class="section-title">Registered Trade Requests</h2>
        <div id="requestsDisplay">
          <!-- We will load and display the trade requests for Shreenand (if needed) -->
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Function to switch between sections
    function showSection(section) {
      document.querySelectorAll('.section').forEach(sec => sec.style.display = 'none');
      document.getElementById(section).style.display = 'block';
      // Optionally, add code here to load data when switching sections.
    }
    
    // Set your deployed Apps Script Web App URL:
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxBeErQY0jTmugWgVH4Gy4KtsdPNyoaHw5cm_uBKf3OOWUD_h7kpUHYxXcM4I2AWzyHbA/exec";
    
    // Function to submit a trade request from Shreenand's portal.
    async function submitTradeRequest(event) {
      event.preventDefault();
      const submitBtn = document.getElementById("submitBtn");
      const loadingIndicator = document.getElementById("loadingIndicator");
      
      // Show loading indicator and disable the button
      loadingIndicator.style.display = "block";
      submitBtn.disabled = true;
      
      const tradeData = {
        action: "submitTradeRequest",
        buyerUID: "A1",         // Shreenand's UID (as buyer)
        buyerName: "Shreenand",
        sellerUID: document.getElementById("sellerUID").value.trim(),
        stock: document.getElementById("stock").value.trim(),
        quantity: document.getElementById("quantity").value,
        price: document.getElementById("price").value
      };
      
      try {
        const response = await fetch(SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(tradeData)
        });
        const result = await response.json();
        alert(result.message);
        document.getElementById("tradeForm").reset();
        // Optionally, call a function to display the registered requests
        loadRegisteredRequests();
      } catch (error) {
        console.error("Error submitting trade request:", error);
        alert("Error submitting trade request. Please try again.");
      } finally {
        loadingIndicator.style.display = "none";
        submitBtn.disabled = false;
      }
    }
    
    // Function to load and display registered trade requests for Shreenand.
    async function loadRegisteredRequests() {
      // For demonstration, we retrieve all requests where buyerUID is "A1"
      // You can adjust this function to load as needed.
      try {
        const response = await fetch(SCRIPT_URL + '?action=getTradeRequests&sellerUID=' + encodeURIComponent("A1"));
        const data = await response.json();
        let html = "";
        if (data.success && data.tradeRequests && data.tradeRequests.length > 0) {
          html += "<table><thead><tr><th>Buyer UID</th><th>Buyer Name</th><th>Seller UID</th><th>Stock</th><th>Quantity</th><th>Price</th><th>Time</th></tr></thead><tbody>";
          data.tradeRequests.forEach(req => {
            html += `<tr>
                      <td>${req.buyerUID}</td>
                      <td>${req.buyerName}</td>
                      <td>${req.sellerUID}</td>
                      <td>${req.stock}</td>
                      <td>${req.quantity}</td>
                      <td>$${req.price}</td>
                      <td>${new Date(req.timestamp).toLocaleString()}</td>
                     </tr>`;
          });
          html += "</tbody></table>";
        } else {
          html = "No registered trade requests.";
        }
        document.getElementById("requestsDisplay").innerHTML = html;
      } catch (error) {
        console.error("Error loading registered requests:", error);
        document.getElementById("requestsDisplay").innerHTML = "Error loading requests.";
      }
    }
    
    // Optionally, you can load registered requests on page load for Shreenand:
    // window.onload = loadRegisteredRequests;
  </script>
</body>
</html>
