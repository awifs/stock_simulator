<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AWIFS - Kamya's Portal</title>
  <style>
    /* Same CSS as before */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body, html { font-family: 'Arial', sans-serif; background: #f4f7f9; color: #333; }
    .sidebar {
      position: fixed; top: 0; left: 0; width: 220px; height: 100vh;
      background-color: #2c3e50; color: #ecf0f1; padding: 20px; overflow-y: auto;
    }
    .sidebar h2 { text-align: center; margin-bottom: 10px; font-size: 24px; letter-spacing: 2px; }
    .sidebar p { text-align: center; margin-bottom: 30px; font-size: 16px; }
    .sidebar ul { list-style: none; }
    .sidebar ul li {
      padding: 15px 20px; margin-bottom: 10px; cursor: pointer; border-radius: 3px;
    }
    .sidebar ul li:hover, .sidebar ul li.active { background-color: #34495e; }
    .main-content { margin-left: 240px; padding: 20px; }
    .card {
      background: #fff; padding: 20px; margin-bottom: 20px;
      border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h2.section-title { margin-bottom: 15px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 10px; border: 1px solid #bdc3c7; text-align: left; }
    th { background: #ecf0f1; }
    form label { display: block; margin: 10px 0 5px; }
    form input, form select { padding: 8px; width: 100%; border: 1px solid #ccc; border-radius: 3px; }
    form button {
      margin-top: 15px; padding: 10px 15px;
      border: none; background-color: #27ae60; color: #fff; border-radius: 3px; cursor: pointer;
    }
    .loading { display: none; color: #007bff; margin-top: 10px; }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <h2>AWIFS Mock Stock</h2>
    <p>UID: A2</p>
    <p>Name: Kamya</p>
    <ul>
      <li class="active" onclick="showSection('dashboard')">Dashboard</li>
      <li onclick="showSection('trade')">Trade</li>
      <li onclick="showSection('portfolio')">Portfolio</li>
      <li onclick="showSection('news')">News</li>
      <li onclick="showSection('leaderboard')">Leaderboard</li>
    </ul>
  </div>
  
  <!-- Main Content -->
  <div class="main-content">
    <!-- Dashboard Section -->
    <div id="dashboard" class="section" style="display: block;">
      <div class="card">
        <h2 class="section-title">Dashboard</h2>
        <table>
          <thead>
            <tr>
              <th>Stock</th>
              <th>Price</th>
              <th>% Change</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>THC</td><td>$100</td><td>+1%</td></tr>
            <tr><td>Fuel Zone</td><td>$200</td><td>-0.5%</td></tr>
          </tbody>
        </table>
      </div>
      <div class="card">
        <h2 class="section-title">Recent Transactions</h2>
        <table>
          <thead>
            <tr>
              <th>Time</th>
              <th>Stock</th>
              <th>Type</th>
              <th>Quantity</th>
              <th>Price</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>12:01</td><td>THC</td><td>Buy</td><td>10</td><td>$100</td></tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Trade Section -->
    <div id="trade" class="section" style="display: none;">
      <div class="card">
        <h2 class="section-title">Send Trade Request</h2>
        <form id="tradeForm" onsubmit="submitTradeRequest(event)">
          <label for="sellerUID">Seller UID:</label>
          <input type="text" id="sellerUID" placeholder="Enter Seller UID (e.g., A1)" required>
          <label for="stock">Stock Symbol:</label>
          <input type="text" id="stock" placeholder="e.g., AAPL" required>
          <label for="quantity">Quantity:</label>
          <input type="number" id="quantity" placeholder="Number of Shares" required>
          <label for="price">Agreed Price:</label>
          <input type="number" id="price" placeholder="Price per Share" required>
          <button type="submit" id="submitBtn">Send Trade Request</button>
          <div class="loading" id="loadingIndicator">Loading...</div>
        </form>
      </div>
      <div class="card">
        <h2 class="section-title">Pending Trade Requests (For You as Seller)</h2>
        <table id="tradeRequestsTable">
          <thead>
            <tr>
              <th>Buyer UID</th>
              <th>Buyer Name</th>
              <th>Stock</th>
              <th>Quantity</th>
              <th>Price</th>
              <th>Time</th>
            </tr>
          </thead>
          <tbody id="requestsTbody">
            <tr><td colspan="6">No trade requests loaded.</td></tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Additional sections (Portfolio, News, Leaderboard) can be added similarly -->
  </div>
  
  <script>
    // Function to switch between sections
    function showSection(section) {
      document.querySelectorAll('.section').forEach(sec => sec.style.display = 'none');
      document.getElementById(section).style.display = 'block';
      if (section === 'trade') {
        loadTradeRequests();
      }
    }
    
    // Set your deployed Apps Script Web App URL:
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwGWSzkIMxyFGW6yxRpqHCg2n_pEG9MgN0eHaeud3xdIjrqPPAFdMDCXfppkv9U_8TwNw/exec";
    
    // Function to submit a trade request from Kamya's portal (as buyer)
    async function submitTradeRequest(event) {
      event.preventDefault();
      const submitBtn = document.getElementById("submitBtn");
      const loadingIndicator = document.getElementById("loadingIndicator");
      
      // Show loading indicator and disable button
      loadingIndicator.style.display = "block";
      submitBtn.disabled = true;
      
      const tradeData = {
        action: "submitTradeRequest",
        buyerUID: "A2",         // Kamya's UID (as buyer)
        buyerName: "Kamya",
        sellerUID: document.getElementById("sellerUID").value.trim(),
        stock: document.getElementById("stock").value.trim(),
        quantity: document.getElementById("quantity").value,
        price: document.getElementById("price").value
      };
      
      try {
        const response = await fetch(SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(tradeData)
        });
        const result = await response.json();
        alert(result.message);
        document.getElementById("tradeForm").reset();
        loadTradeRequests();
      } catch (error) {
        console.error("Error submitting trade request:", error);
        alert("Error submitting trade request. Please try again.");
      } finally {
        loadingIndicator.style.display = "none";
        submitBtn.disabled = false;
      }
    }
    
    // Function to load pending trade requests where sellerUID equals Kamya's UID ("A2")
    async function loadTradeRequests() {
      const sellerUID = "A2"; // Kamya's UID as seller
      try {
        const response = await fetch(SCRIPT_URL + '?action=getTradeRequests&sellerUID=' + encodeURIComponent(sellerUID));
        const data = await response.json();
        const tbody = document.getElementById("requestsTbody");
        tbody.innerHTML = "";
        if (data.success && data.tradeRequests && data.tradeRequests.length > 0) {
          data.tradeRequests.forEach(req => {
            tbody.innerHTML += `<tr>
              <td>${req.buyerUID}</td>
              <td>${req.buyerName}</td>
              <td>${req.stock}</td>
              <td>${req.quantity}</td>
              <td>$${req.price}</td>
              <td>${new Date(req.timestamp).toLocaleString()}</td>
            </tr>`;
          });
        } else {
          tbody.innerHTML = `<tr><td colspan="6">No pending trade requests.</td></tr>`;
        }
      } catch (error) {
        console.error("Error loading trade requests:", error);
      }
    }
    
    // Optionally load trade requests automatically on page load
    // window.onload = loadTradeRequests;
  </script>
</body>
</html>
